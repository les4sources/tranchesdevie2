<% content_for :title, "Mangeur - #{@customer.full_name}" %>
<% content_for :layout, "admin" %>

<div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
  <h1 class="text-2xl font-bold text-gray-900">Mangeur : <%= @customer.full_name %></h1>
  <div class="flex space-x-3">
    <%= link_to "Modifier", edit_admin_customer_path(@customer), class: "inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white shadow-sm hover:bg-gray-50" %>
    <%= link_to "Nouvelle commande", new_admin_order_path(customer_id: @customer.id), class: "inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md shadow-sm hover:bg-green-700" %>
  </div>
</div>

<div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <h2 class="text-lg font-medium text-gray-900 mb-4">Informations</h2>
    
    <dl class="space-y-3">
      <div>
        <dt class="text-sm font-medium text-gray-500">Prénom</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @customer.first_name %></dd>
      </div>

      <% if @customer.last_name.present? %>
        <div>
          <dt class="text-sm font-medium text-gray-500">Nom</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @customer.last_name %></dd>
        </div>
      <% end %>

      <div>
        <dt class="text-sm font-medium text-gray-500">Téléphone</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @customer.phone_e164 %></dd>
      </div>

      <% if @customer.email.present? %>
        <div>
          <dt class="text-sm font-medium text-gray-500">Email</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @customer.email %></dd>
        </div>
      <% end %>

      <div>
        <dt class="text-sm font-medium text-gray-500">SMS activé</dt>
        <dd class="mt-1">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= @customer.sms_enabled? ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
            <%= @customer.sms_enabled? ? 'Oui' : 'Non' %>
          </span>
        </dd>
      </div>

      <div>
        <dt class="text-sm font-medium text-gray-500">Date d'inscription</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @customer.created_at.strftime("%d/%m/%Y à %H:%M") %></dd>
      </div>
    </dl>
  </div>

  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <h2 class="text-lg font-medium text-gray-900 mb-4">Statistiques</h2>
    
    <dl class="space-y-3">
      <div>
        <dt class="text-sm font-medium text-gray-500">Nombre de commandes</dt>
        <dd class="mt-1 text-lg font-medium text-gray-900"><%= @customer.orders.count %></dd>
      </div>

      <% total_revenue = @customer.orders.where(status: Order::COMPLETED_STATUSES).sum(:total_cents) %>
      <div>
        <dt class="text-sm font-medium text-gray-500">Chiffre d'affaires total</dt>
        <dd class="mt-1 text-lg font-medium text-gray-900">
          <%= number_to_currency(total_revenue / 100.0, unit: "€", separator: ",", delimiter: "") %>
        </dd>
      </div>
    </dl>
  </div>
</div>

<div class="mt-6 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
  <h2 class="text-lg font-medium text-gray-900 mb-4">Commandes</h2>
  
  <% if @orders.any? %>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Commande</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jour de cuisson</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @orders.each do |order| %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                <%= order.order_number %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                <%= order.bake_day.baked_on.strftime("%d/%m/%Y") %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= number_to_currency(order.total_euros, unit: "€", separator: ",", delimiter: "") %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                  <%= case order.status
                      when 'pending' then 'bg-yellow-100 text-yellow-800'
                      when 'paid' then 'bg-blue-100 text-blue-800'
                      when 'ready' then 'bg-green-100 text-green-800'
                      when 'picked_up' then 'bg-gray-100 text-gray-800'
                      when 'no_show' then 'bg-red-100 text-red-800'
                      when 'cancelled' then 'bg-red-100 text-red-800'
                      when 'unpaid' then 'bg-orange-100 text-orange-800'
                      else 'bg-gray-100 text-gray-800'
                      end %>">
                  <%= order_status_label(order.status) %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                <%= order.created_at.strftime("%d/%m/%Y") %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <%= link_to "Voir", admin_order_path(order), class: "text-blue-600 hover:text-blue-800" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="text-sm text-gray-500">Aucune commande pour ce mangeur.</p>
  <% end %>
</div>

<div class="mt-6">
  <%= link_to "← Retour à la liste des mangeurs", admin_customers_path, class: "text-blue-600 hover:text-blue-800" %>
</div>

