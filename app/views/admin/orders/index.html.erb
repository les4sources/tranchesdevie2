<% content_for :title, "Commandes" %>
<% content_for :layout, "admin" %>

<div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
  <h1 class="text-2xl font-bold text-gray-900">Commandes</h1>
  <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:space-x-3">
    <%= link_to "Nouveau mangeur",
                new_admin_customer_path,
                class: "inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400" %>
    <%= link_to "Nouvelle commande",
                new_admin_order_path,
                class: "inline-flex items-center justify-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" %>
  </div>
</div>

<div class="bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden">
  <div class="px-6 py-4 border-b border-gray-200">
    <div class="flex justify-between items-center">
      <h2 class="text-lg font-medium text-gray-900">Toutes les commandes</h2>
      
      <div class="flex space-x-4">
        <%= form_with url: admin_orders_path, method: :get, local: true, class: "flex space-x-2" do |f| %>
          <%= f.select :status, options_for_select([
            ['Tous', ''],
            ['En attente', 'pending'],
            ['Payées', 'paid'],
            ['Prêtes', 'ready'],
            ['Récupérées', 'picked_up'],
            ['Non récupérées', 'no_show'],
            ['Annulées', 'cancelled']
          ], params[:status]), {}, { class: "rounded-md border-gray-300" } %>
          
          <%= f.select :bake_day_id, options_from_collection_for_select(@bake_days, :id, :baked_on, params[:bake_day_id]), 
              { include_blank: 'Tous les jours' }, 
              { class: "rounded-md border-gray-300" } %>
          
          <%= f.submit "Filtrer", class: "px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700" %>
        <% end %>
      </div>
    </div>
  </div>

  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Commande</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jour de cuisson</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% @orders.each do |order| %>
        <tr>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
            <%= order.order_number %>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
            <%= order.customer.full_name %>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
            <%= order.bake_day.baked_on.strftime("%d/%m/%Y") %>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            <%= number_to_currency(order.total_euros, unit: "€", separator: ",", delimiter: "") %>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
              <%= case order.status
                  when 'pending' then 'bg-yellow-100 text-yellow-800'
                  when 'paid' then 'bg-blue-100 text-blue-800'
                  when 'ready' then 'bg-green-100 text-green-800'
                  when 'picked_up' then 'bg-gray-100 text-gray-800'
                  when 'no_show' then 'bg-red-100 text-red-800'
                  when 'cancelled' then 'bg-red-100 text-red-800'
                  else 'bg-gray-100 text-gray-800'
                  end %>">
              <%= order_status_label(order.status) %>
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <%= link_to "Voir", admin_order_path(order), class: "text-blue-600 hover:text-blue-800" %>
            <%= link_to "Modifier", edit_admin_order_path(order), class: "ml-4 text-indigo-600 hover:text-indigo-800" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

