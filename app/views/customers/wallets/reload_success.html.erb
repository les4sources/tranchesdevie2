<% content_for :title, "Recharge confirmée" %>

<div class="w-full max-w-md mx-auto text-center" data-reload-success-page>
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
      <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
    </div>

    <h1 class="text-2xl font-bold text-gray-900 mb-4">Recharge confirmée</h1>

    <% if @amount_cents %>
      <p class="text-gray-600 mb-6">
        Votre portefeuille a été rechargé de
        <span class="font-bold text-green-600"><%= number_to_currency(@amount_cents / 100.0, unit: '€', format: '%n %u') %></span>
      </p>
    <% end %>

    <p class="text-sm text-gray-500 mb-6">
      Nouveau solde : <span class="font-bold"><%= number_to_currency(@wallet.balance_euros, unit: '€', format: '%n %u') %></span>
    </p>

    <div class="flex gap-3 justify-center">
      <%= link_to "Voir mon portefeuille", customers_wallet_path, class: "px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700" %>
      <%= link_to "Planifier mes commandes", calendar_path, class: "px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200" %>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
  function launchConfetti() {
    if (typeof confetti === 'undefined') return;

    const duration = 3000;
    const animationEnd = Date.now() + duration;
    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

    function randomInRange(min, max) {
      return Math.random() * (max - min) + min;
    }

    const interval = setInterval(function() {
      const timeLeft = animationEnd - Date.now();
      if (timeLeft <= 0) return clearInterval(interval);

      const particleCount = 50 * (timeLeft / duration);
      confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
      confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
    }, 250);
  }

  function initConfetti() {
    if (!document.querySelector('[data-reload-success-page]')) return;
    if (typeof confetti !== 'undefined') {
      launchConfetti();
    } else {
      setTimeout(initConfetti, 100);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initConfetti);
  } else {
    initConfetti();
  }

  document.addEventListener('turbo:load', function() {
    if (document.querySelector('[data-reload-success-page]') && typeof confetti !== 'undefined') {
      launchConfetti();
    }
  });
</script>
